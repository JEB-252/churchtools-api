<!DOCTYPE html>
<html>
<head>
    <title>Appointments</title>
    <link rel="stylesheet" href="/static/css/common.css">
    <!-- Include jQuery UI CSS from a CDN -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <!-- Include jQuery from a CDN -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- Include jQuery UI from a CDN -->
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <!-- Initialize the datepicker -->
    <script>
        $(function() {
            $("#start_date").datepicker({
                dateFormat: "yy-mm-dd" // This format should match the value you're passing from Flask
            });
            $("#end_date").datepicker({
                dateFormat: "yy-mm-dd"
            });
        });
    </script>
</head>
<body>
<div class="container">
    <a href="/" class="btn btn-back">Zurück</a>
    <h1>Termine nächste Woche</h1>

    <!-- Form to fetch appointments -->
    <form method="POST">
        <!-- Calendars selection -->
        <div class="calendars-container">
            {% for calendar in calendars %}
                <div class="calendar-item">
                    <input type="checkbox" id="calendar-{{ calendar['id'] }}"
                           name="calendar_ids" value="{{ calendar['id'] }}"
                           class="calendar-checkbox" {% if calendar['id'] in selected_calendar_ids %} checked {% endif %}>
                    <label for="calendar-{{ calendar['id'] }}" class="calendar-label">
                        {{ calendar['name'] }}
                    </label>
                </div>
            {% endfor %}
        </div>

        <!-- Date selection -->
        <label for="start_date">Startdatum:</label>
        <input type="text" id="start_date" name="start_date"
               value="{{ start_date }}" required>

        <label for="end_date">Enddatum:</label>
        <input type="text" id="end_date" name="end_date"
               value="{{ end_date }}" required>

        <!-- Submit button for fetching appointments -->
        <input type="submit" name="fetch_appointments"
               value="Termine abholen" class="btn btn-fetch">
    </form>
    {% if appointments %}
    <form method="POST" enctype="multipart/form-data">
        <div class="appointments-container">
            {% for appointment in appointments %}
                <div class="appointment-item">
                    <input type="checkbox" id="appointment-{{ appointment['id'] }}" name="appointment_id" value="{{ appointment['id'] }}" class="appointment-checkbox" checked>
                    <label for="appointment-{{ appointment['id'] }}" class="appointment-label">{{ appointment['startDateView'] }} ({{ appointment['startTimeView'] }}-{{ appointment['endTimeView'] }}) <br/>{{ appointment['description'] }}</label>
                </div>
            {% endfor %}
        </div>

        <!-- Input for file upload -->
        <label for="background_image">Hintergrundbild:</label>
        <input type="file" id="background_image" name="background_image" accept="image/*">

        <input type="submit" name="generate_pdf" value="PDF Generieren" class="btn btn-generate">
    </form>
    {% else %}
        <p>...</p>
    {% endif %}
</div>
</body>
</html>
